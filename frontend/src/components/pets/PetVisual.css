/* ============================================================================
   WORLD ANCHOR
   ============================================================================ */

/* Anchors pet relative to the shared world ground */
.pet-world-anchor {
  position: absolute;
  left: 50%;
  bottom: var(--world-ground-y, 45%);
  transform: translateX(-50%);
  z-index: 5;
  pointer-events: none;
}

/* ============================================================================
   PET CONTAINER
   ============================================================================ */

.pet-visual-container {
  position: relative;
  transform: translateY(50%); /* Sink feet into ground slightly */
}

/* ============================================================================
   PET SPRITE
   ============================================================================ */

.pet {
  position: relative;
  width: var(--pet-size, 220px);
  max-width: 40vw;
  transform: translateZ(0);
  will-change: transform, filter;
}

/* ============================================================================
   LAYERS
   ============================================================================ */

.pet-body-layer,
.pet-eyes-layer,
.pet-tail-layer {
  position: absolute;
  inset: 0;
  width: 100%;
  height: auto;
  display: block;
  pointer-events: none;
  transform-origin: 50% 70%;
  will-change: transform, opacity, filter;
}

/* ============================================================================
  ANIMATION STATES
  ============================================================================ */

@keyframes petIdleBob {
  0% { transform: translate3d(0, 0, 0); }
  50% { transform: translate3d(0, -6px, 0); }
  100% { transform: translate3d(0, 0, 0); }
}

@keyframes petWalkBob {
  0% { transform: translate3d(-10px, 0, 0) rotate(-1.2deg); }
  25% { transform: translate3d(-3px, -6px, 0) rotate(0.6deg); }
  50% { transform: translate3d(4px, 0, 0) rotate(1.2deg); }
  75% { transform: translate3d(10px, -6px, 0) rotate(-0.6deg); }
  100% { transform: translate3d(-10px, 0, 0) rotate(-1.2deg); }
}

@keyframes petEat {
  0% { transform: translate3d(0, 0, 0) rotate(0deg); }
  30% { transform: translate3d(0, -3px, 0) rotate(-1deg); }
  60% { transform: translate3d(0, 0, 0) rotate(1deg); }
  100% { transform: translate3d(0, 0, 0) rotate(0deg); }
}

@keyframes petPlay {
  0% { transform: translate3d(0, 0, 0) rotate(0deg) scale(1); }
  35% { transform: translate3d(0, -14px, 0) rotate(-3deg) scale(1.03); }
  70% { transform: translate3d(0, 0, 0) rotate(3deg) scale(0.99); }
  100% { transform: translate3d(0, 0, 0) rotate(0deg) scale(1); }
}

@keyframes petBatheShake {
  0% { transform: translate3d(0, 0, 0) rotate(0deg); }
  10% { transform: translate3d(-4px, -2px, 0) rotate(-2deg); }
  20% { transform: translate3d(4px, 2px, 0) rotate(2deg); }
  30% { transform: translate3d(-4px, 1px, 0) rotate(-2deg); }
  40% { transform: translate3d(4px, -1px, 0) rotate(2deg); }
  50% { transform: translate3d(-3px, 0, 0) rotate(-1deg); }
  60% { transform: translate3d(3px, 0, 0) rotate(1deg); }
  100% { transform: translate3d(0, 0, 0) rotate(0deg); }
}

@keyframes petSleep {
  0% { transform: translate3d(0, 0, 0) rotate(0deg); opacity: 1; }
  50% { transform: translate3d(0, 2px, 0) rotate(0.4deg); opacity: 0.95; }
  100% { transform: translate3d(0, 0, 0) rotate(0deg); opacity: 1; }
}

@keyframes petTailWag {
  0% { transform: rotate(-8deg); }
  50% { transform: rotate(10deg); }
  100% { transform: rotate(-8deg); }
}

@keyframes petBlink {
  0% { transform: scaleY(1); }
  46% { transform: scaleY(1); }
  48% { transform: scaleY(0.08); }
  50% { transform: scaleY(1); }
  100% { transform: scaleY(1); }
}

.pet-state-idle {
  animation: petIdleBob 2.8s ease-in-out infinite;
}

.pet-state-walk {
  animation: petWalkBob 1.2s ease-in-out infinite;
}

.pet-state-eat {
  animation: petEat 0.55s ease-in-out infinite;
}

.pet-state-play {
  animation: petPlay 0.7s ease-in-out infinite;
}

.pet-state-bathe {
  animation: petBatheShake 0.55s ease-in-out infinite;
}

.pet-state-sleep {
  animation: petSleep 3.2s ease-in-out infinite;
  filter: saturate(0.9) brightness(0.98);
}

.pet-state-idle .pet-tail-layer,
.pet-state-walk .pet-tail-layer,
.pet-state-play .pet-tail-layer {
  transform-origin: 55% 65%;
  animation: petTailWag 0.9s ease-in-out infinite;
}

.pet-state-eat .pet-tail-layer {
  transform-origin: 55% 65%;
  animation: petTailWag 1.15s ease-in-out infinite;
}

.pet-state-sleep .pet-tail-layer {
  animation: none;
}

.pet-eyes-layer {
  animation: petBlink 5.2s ease-in-out infinite;
  transform-origin: 50% 50%;
}

/* ============================================================================
  STAT-DRIVEN POLISH
  ============================================================================ */

.pet {
  --pet-energy-clamp: max(0, min(100, var(--pet-energy)));
  --pet-cleanliness-clamp: max(0, min(100, var(--pet-cleanliness)));
}

.pet {
  filter:
    saturate(calc(0.85 + (var(--pet-happiness, 50) / 250)))
    brightness(calc(0.92 + (var(--pet-energy, 50) / 400)));
}

.pet-state-bathe {
  filter: saturate(1.05) brightness(1.02);
}

/* ============================================================================
  ACCESSIBILITY: REDUCED MOTION
  ============================================================================ */

@media (prefers-reduced-motion: reduce) {
  .pet,
  .pet-body-layer,
  .pet-eyes-layer,
  .pet-tail-layer {
    animation: none !important;
    transition: none !important;
  }
}

/* ============================================================================
   SHADOW
   ============================================================================ */

.pet-shadow {
  position: absolute;
  left: 50%;
  bottom: -6px;
  transform: translateX(-50%);
  width: 60%;
  height: 16px;
  background: radial-gradient(
    ellipse,
    rgba(0, 0, 0, 0.35) 0%,
    transparent 70%
  );
  filter: blur(6px);
  z-index: -1;
}