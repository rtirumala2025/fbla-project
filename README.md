# Virtual Pet FBLA Project

An end-to-end virtual pet simulator that teaches financial literacy through gameplay. Students adopt a companion, manage virtual budgets, play adaptive mini-games, and receive AI-driven coachingâ€”all powered by a React frontend, FastAPI backend, and Supabase storage.

## Table of Contents
- [Overview](#overview)
- [Feature Highlights](#feature-highlights)
- [System Architecture](#system-architecture)
- [Tech Stack](#tech-stack)
- [Prerequisites](#prerequisites)
- [Setup](#setup)
- [Running Locally](#running-locally)
- [Deployment Guide](#deployment-guide)
- [Testing & Quality Gates](#testing--quality-gates)
- [Competition Demo Flow](#competition-demo-flow)
- [Documentation & Assets](#documentation--assets)
- [Competition Checklist](#competition-checklist)

## Overview
The project is designed for FBLA Intro to Programming competition judges. It provides a polished experience with clear documentation, seeding scripts, and demo assets so teams can stand up the system, run a guided walkthrough, and discuss the underlying architecture.

## Feature Highlights
- **Core Pet Care** â€“ Feed, play, clean, and rest activities update pet stats with real-time animations and celebratory effects.
- **AI Companion** â€“ Mood analysis, personality profiles, intent parsing, and proactive notifications generated by `app/services/ai_service.py`.
- **Financial Literacy** â€“ Wallet tracking, shop purchases, earn events, and leaderboards handled through `finance_service.py`.
- **Analytics & Reporting** â€“ `/analytics` dashboard surfaces daily/weekly summaries, CSV exports, and AI insights.
- **Mini-Games & Next-Gen Lab** â€“ Fetch, Memory, Puzzle, DreamWorld, and NextGen Hub concepts with difficulty scaling.
- **Accessibility & Inclusivity** â€“ Theme toggle, color-blind mode, focus management, and offline caching built into the UI.
- **Competition Utilities** â€“ Seed/demo data script, coverage reports, presentation deck, and user manual prepared for judges.

## System Architecture
- **Frontend (`frontend/`)** â€“ React + TypeScript SPA, Framer Motion transitions, React Context for auth/theme/pet state, and Supabase client for realtime updates.
- **Backend (`app/`)** â€“ FastAPI service exposing domain routers for auth, pets, finance, analytics, games, and next-gen exploratory features.
- **Database (Supabase Postgres)** â€“ Auth + row-level security with `profiles`, `user_preferences`, `pets`, and additional finance/shop tables inserted via seeding script.
- **AI & Analytics Services** â€“ Service layer abstracts mood scoring, financial summaries, leaderboard logic, and next-gen projections.
- **Observability & Testing** â€“ Pytest suites for backend services, Playwright/E2E coverage for critical flows, and coverage report.

See `docs/architecture-diagram.{mmd,svg}` for the full component diagram and `docs/supabase-erd.{mmd,svg}` for the ERD.

## Tech Stack
- **Frontend:** React 18, TypeScript, React Router, Framer Motion, Tailwind CSS.
- **Backend:** FastAPI, SQLAlchemy, Pydantic, AsyncIO.
- **Database:** Supabase (Postgres) with RLS policies and SQL migrations.
- **AI & Analytics:** OpenRouter-ready service abstractions, deterministic AI stubs.
- **Tooling:** Vite, npm, pytest, Playwright, ESLint, Prettier, Alembic.

## Prerequisites
- Node.js 18+ and npm.
- Python 3.12+ with `pip`.
- Supabase project (free tier works) with SQL editor access.
- Optional: OpenRouter or OpenAI API keys for live AI completions.

## Setup
### 1. Clone & install dependencies
```bash
git clone https://github.com/your-org/virtual-pet-fbla.git
cd "/Users/<you>/Desktop/FBLA Intro to Programming - Code FIles"
npm install
pip install -r requirements.txt
```

Install frontend dependencies separately (Vite expects a local `node_modules`):
```bash
cd frontend
npm install
cd ..
```

### 2. Configure environment variables
Copy provided templates and fill in secrets (see `env.example` for full list).

Frontend (`frontend/.env`):
```env
VITE_SUPABASE_URL=https://your-project-id.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_API_URL=http://localhost:8000
VITE_ENABLE_MOCKS=false        # set true to demo without backend
VITE_SUPABASE_STORAGE_BUCKET=avatars
```

Backend (`.env` in repo root or `app/.env`):
```env
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/virtual_pet
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_JWT_SECRET=your-jwt-secret
OPENROUTER_API_KEY=optional-openrouter-key
OPENROUTER_MODEL=openrouter/llama-4-11b-instruct-scout
OPENAI_API_KEY=optional-openai-key
OPENAI_IMAGE_MODEL=gpt-image-1
OPENAI_IMAGE_API=https://api.openai.com/v1/images/generations
ALLOWED_ORIGINS=http://localhost:5173
JWT_SECRET=change-me
```

### 3. Provision Supabase
1. Create a project at https://app.supabase.com.
2. In **SQL Editor**, run the core migrations in order:
   - `supabase/migrations/000_core_schema.sql`
   - `supabase/migrations/001_profiles_and_preferences.sql`
   - `supabase/migrations/002_pets.sql`
   - `supabase/migrations/003_social_layer.sql`
   - `supabase/migrations/004_accessories_and_art_cache.sql`
   - `supabase/migrations/005_finance_system.sql`
   - `supabase/migrations/006_quests.sql`
   - `supabase/migrations/007_games.sql`
   - `supabase/migrations/008_analytics_and_sync.sql`
   - `supabase/migrations/009_realtime_and_replication.sql`
3. Seed demo data:
   - Comprehensive: run `scripts/seed_demo_data.sql` in Supabase SQL Editor after replacing placeholder emails.
   - Lightweight competition reset: run `scripts/seed_competition_data.sql`.
4. Confirm RLS is enabled and tables exist in **Table Editor** (`profiles`, `pets`, `user_preferences`, `pet_inventory`, `finance_*`, `shop_items`).

### 4. Export documentation bundle (optional but recommended)
```bash
python3 scripts/generate_assets.py --ensure-video
```
Outputs: `docs/user-manual.pdf`, `docs/presentation-deck.pdf`, `docs/demo-storyboard.pdf`, and `docs/demo-video.mp4`.

## Running Locally
1. **Start backend (FastAPI):**
   ```bash
   uvicorn app.main:app --reload --port 8000
   ```
   Interactive docs are at http://localhost:8000/docs.

2. **Start frontend (React/Vite):**
   ```bash
   cd frontend
   npm run dev
   ```
   The app defaults to http://localhost:5173 with hot reloading.

3. **Optional verifications:**
   - Run `scripts/verify_frontend_phase2.sh` to confirm Supabase connectivity.
   - Visit `/analytics`, `/shop`, and `/minigames/*` paths to confirm routing guards.
   - Regenerate PDFs via `python3 scripts/generate_assets.py` after doc edits.

## Deployment Guide
### Frontend (Vercel or Netlify)
- Import the repo, select the `frontend` directory.
- Set build command `npm run build` and output directory `frontend/dist`.
- Configure environment variables: `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`, `VITE_API_URL` (Production API endpoint).

### Backend (Render, Railway, or Fly.io)
- Deploy the FastAPI app using the provided `app/main.py`.
- Set `START_COMMAND` to `uvicorn app.main:app --host 0.0.0.0 --port 8000`.
- Provide `DATABASE_URL` (Supabase connection string), `SUPABASE_SERVICE_ROLE_KEY`, and any analytics keys.
- Enable HTTPS and configure CORS to allow the frontend origin.

### Supabase & Secrets
- Copy the service role key into backend env ONLY.
- Set Row Level Security policies as provided in migrations.
- (Optional) Add cron jobs for daily analytics via Supabase Edge Functions or backend scheduled tasks.

## Testing & Quality Gates
- **Backend unit tests:** `pytest`
- **Coverage report:** `pytest --cov=app --cov-report=term-missing`
- **Frontend unit/lint:** `cd frontend && npm test -- --watchAll=false && npm run lint`
- **E2E smoke:** `npx playwright test` (requires browsers installed via `npx playwright install`).
- Reports and instructions live in `test-results/` and `playwright-report/`.

## Competition Demo Flow
1. **Onboard:** Register, complete profile setup, pick species/breed, and name the pet.
2. **Care Loop:** Use feed/play/clean/rest routes to update stats and trigger AI reactions.
3. **Finance & Shop:** Earn coins in `/earn`, purchase items in `/shop`, and show balance + ledger.
4. **Analytics Insights:** Navigate to `/analytics` to showcase charts, CSV export, and AI recommendations.
5. **Mini-Games:** Launch a mini-game (e.g., `/minigames/memory`) to highlight adaptive difficulty.
6. **Next-Gen Vision:** Visit `/nextgen` to discuss voice commands, AR, and weather integrations.
7. **Fail-safe Video:** Use `docs/demo-video.mp4` as the downloadable backup; update with a narrated run-through before judging.

## Documentation & Assets
- `docs/architecture-diagram.{mmd,svg}` â€“ High-level system architecture (frontend â†” backend â†” Supabase).
- `docs/supabase-erd.{mmd,svg}` â€“ Relational model covering auth, pets, finance, and inventory tables.
- `docs/user-manual.{md,pdf}` â€“ End-user guide; PDF generated via `scripts/generate_assets.py`.
- `docs/presentation-deck.{md,pdf}` â€“ Slide outline and ready-to-present PDF deck.
- `docs/demo-storyboard.{md,pdf}` â€“ Scene-by-scene plan aligning with the demo video.
- `docs/demo-script.md` â€“ Step-by-step live demo script with timing cues.
- `docs/demo-video.mp4` â€“ Downloadable fallback walkthrough (replace with narrated recording).
- `scripts/seed_demo_data.sql` â€“ Comprehensive Supabase seeding for wallets, inventory, and analytics.
- `scripts/seed_competition_data.sql` â€“ Lightweight seed for rapid resets between judge demos.
- `reports/test-coverage.md` â€“ Latest coverage snapshot and interpretation.
- `LICENSE` â€“ MIT license for competition submission.

## Competition Checklist
- [ ] Environment variables configured in both frontend and backend.
- [ ] Supabase migrations + seed script executed.
- [ ] Frontend + backend deployed with correct origins/CORS.
- [ ] Coverage report generated and saved in `reports/test-coverage.md`.
- [ ] Presentation deck, demo script, and user manual printed/exported to PDF.
- [ ] Backup demo video accessible offline.
- [ ] Judges have quick access to README, architecture diagram, and ERD.

Good luck in competitionâ€”refer to the user manual for talking points, and pair the presentation deck with the demo script for a polished run-through. You've got this! ðŸ’ª
